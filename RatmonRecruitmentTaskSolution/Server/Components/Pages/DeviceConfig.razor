@page "/device/config/{DeviceId}"
@using DeviceBase
@using Microsoft.AspNetCore.Authorization
@using Server.Components.Shared
@using Server.Data.Models
@using Server.Services
@using System.Text.Json
@using global::Shared
@rendermode InteractiveServer

@inject NavigationManager NavigationManager
@inject DeviceService DeviceService
@inject DeviceDataService DeviceDataService
@inject RabbitMQDeviceConfigService RabbitMQDeviceConfigService
@inject NotificationService NotificationService

@attribute [Authorize]

@if (currentDevice is not null)
{
    <PageTitle>Device - @currentDevice.Name</PageTitle>
}
else
{
    <PageTitle>Loading data...</PageTitle>
}


<RadzenRow>
    <RadzenColumn Size="12">
        <RadzenCard>
            <RadzenRow>
                <RadzenColumn Size="12" SizeLG="4">
                    <RadzenStack Orientation="Radzen.Orientation.Vertical">
                        <RadzenLabel>Unique device id:</RadzenLabel>
                        @if (currentDevice == null)
                        {
                            <RadzenSkeleton />
                        }
                        else
                        {
                            <RadzenTextBox @bind-Value=@currentDevice.Id Disabled=true></RadzenTextBox>
                        }
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeLG="4">
                    <RadzenStack Orientation="Radzen.Orientation.Vertical">
                        <RadzenLabel>Device type:</RadzenLabel>
                        @if (currentDevice == null)
                        {
                            <RadzenSkeleton />
                        }
                        else
                        {
                            <RadzenTextBox Value=@currentDevice.Type.ToString() Disabled=true></RadzenTextBox>
                        }
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeLG="4">
                    <RadzenStack Orientation="Radzen.Orientation.Vertical">
                        <RadzenLabel>Device name:</RadzenLabel>
                        @if (currentDevice == null || deviceConfig == null)
                        {
                            <RadzenSkeleton />
                        }
                        else
                        {
                            <RadzenTextBox @bind-Value=@deviceConfig.Name></RadzenTextBox>
                        }
                    </RadzenStack>
                </RadzenColumn>
            </RadzenRow>
        </RadzenCard>
    </RadzenColumn>
    <RadzenColumn Size="12">
        @if (currentDevice == null || deviceConfig == null)
        {
            <RadzenSkeleton />
        }
        else
        {
            <RadzenCard>
                <RadzenRow>
                    @switch (currentDevice.Type)
                    {
                        case DeviceType.MOUSE2:
                            <RadzenColumn Size="12" SizeLG="6">
                                <RadzenStack Orientation="Radzen.Orientation.Vertical">
                                    <RadzenLabel>Alarm threshold:</RadzenLabel>
                                    <RadzenNumeric @bind-Value=@((deviceConfig as Config_MOUSE2)!.AlarmThreshold)></RadzenNumeric>
                                </RadzenStack>
                            </RadzenColumn>
                            break;
                        case DeviceType.MOUSE2B:
                            <RadzenColumn Size="12" SizeLG="6">
                                <RadzenStack Orientation="Radzen.Orientation.Vertical">
                                    <RadzenLabel>Alarm threshold:</RadzenLabel>
                                    <RadzenNumeric @bind-Value=@((deviceConfig as Config_MOUSE2B)!.AlarmThreshold)></RadzenNumeric>
                                </RadzenStack>
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeLG="6">
                                <RadzenStack Orientation="Radzen.Orientation.Vertical">
                                    <RadzenLabel>Cable length:</RadzenLabel>
                                    <RadzenNumeric @bind-Value=@((deviceConfig as Config_MOUSE2B)!.CableLength)></RadzenNumeric>
                                </RadzenStack>
                            </RadzenColumn>
                            break;
                        case DeviceType.MOUSECOMBO:
                            <RadzenColumn Size="12" SizeLG="6">
                                <RadzenStack Orientation="Radzen.Orientation.Vertical">
                                    <RadzenLabel>Alarm threshold:</RadzenLabel>
                                    <RadzenNumeric @bind-Value=@((deviceConfig as Config_MOUSECOMBO)!.AlarmThreshold)></RadzenNumeric>
                                </RadzenStack>
                            </RadzenColumn>
                            break;
                        case DeviceType.MAS2:
                            <RadzenColumn Size="12" SizeLG="6">
                                <RadzenStack Orientation="Radzen.Orientation.Vertical">
                                    <RadzenLabel>Temperature threshold:</RadzenLabel>
                                    <RadzenNumeric @bind-Value=@((deviceConfig as Config_MAS2)!.TemperatureThreshold)></RadzenNumeric>
                                </RadzenStack>
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeLG="6">
                                <RadzenStack Orientation="Radzen.Orientation.Vertical">
                                    <RadzenLabel>Humidity threshold:</RadzenLabel>
                                    <RadzenNumeric @bind-Value=@((deviceConfig as Config_MAS2)!.HumidityThreshold)></RadzenNumeric>
                                </RadzenStack>
                            </RadzenColumn>
                            break;
                    }
                </RadzenRow>
            </RadzenCard>
        }
    </RadzenColumn>
    <RadzenColumn Size="12">
        <RadzenCard>
            <RadzenStack Orientation="Radzen.Orientation.Vertical">
                <RadzenButton Icon="save" Click=@(args => SaveConfig())>Save</RadzenButton>
            </RadzenStack>
        </RadzenCard>
    </RadzenColumn>
</RadzenRow>
